# Admin 后台功能文档

> 新闻胶囊管理后台，用于内容管理、配置和运维

---

## 概述

Admin 后台提供完整的内容管理能力，支持：
- 信息源配置与管理
- 新闻条目的状态流转
- AI 摘要生成与调试
- 用户反馈处理
- 系统设置

**访问地址**：`/admin`

**认证方式**：用户名/密码登录，通过 `ADMIN_USERS` 环境变量配置

---

## 模块说明

### 1. 编辑部工作台 (`/admin`)

主工作台，提供全局视图和快速操作。

```
┌────────────────────────────────────────────────────────────────┐
│  📊 编辑部工作台                                                │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 统计概览                                                  │  │
│  │ • 新(new): 12   • 待处理(pending): 5                     │  │
│  │ • 队列(queued): 3   • 已发布(published): 45              │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 全局筛选                                                  │  │
│  │ 日期: [2026-01-05 ▼]  状态: [全部 ▼]                     │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 信息源列表 (按语言分组)                                   │  │
│  │                                                          │  │
│  │ 🇨🇳 中文源                                                │  │
│  │ ├── 极客公园 (5 new, 2 pending)  [▼展开]                 │  │
│  │ └── 36氪 (3 new) [▼展开]                                 │  │
│  │                                                          │  │
│  │ 🇺🇸 英文源                                                │  │
│  │ ├── The Verge (4 new) [▼展开]                            │  │
│  │ └── TechCrunch (2 new) [▼展开]                           │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│  展开后显示条目列表，支持：                                     │
│  • 查看原始标题和摘要                                          │
│  • 状态切换 (new → pending → queued → published)              │
│  • 单条重新生成                                                 │
│  • 分页浏览 (每页10条)                                         │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

#### 状态流转

```
new (新) → pending (待处理) → queued (队列) → published (已发布)
                                    ↓
                              archived (已归档)
```

---

### 2. 信息源管理 (`/admin/sources`)

管理 RSS 信息源。

**功能列表**：
- ➕ 添加新信息源
- ✏️ 编辑信息源（名称、URL）
- 🔄 启用/禁用信息源
- 🗑️ 删除信息源
- 📊 查看同步状态和条目数量

**分组与排序**：
- 按语言分组（中文源、英文源）
- 支持按活跃度或添加时间排序

---

### 3. 已发布内容 (`/admin/published`)

查看和管理已发布的新闻摘要。

**功能列表**：
- 📅 按日期和信息源筛选
- 🔄 批量重新生成摘要
- 👁️ 预览已发布内容
- 📊 查看发布时间

---

### 4. Prompt 调试器 (`/admin/prompt-debugger`)

测试和优化 AI Prompt。

```
┌────────────────────────────────────────────────────────────────┐
│  🧪 Prompt 调试器                                              │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌────────────────────────┐  ┌────────────────────────────┐   │
│  │ Prompt 编辑区          │  │ 生成结果                    │   │
│  │                        │  │                            │   │
│  │ ## 角色设定            │  │ editorNote:               │   │
│  │ 你是一个专业的新闻编辑..│  │ 苹果今日发布...            │   │
│  │                        │  │                            │   │
│  │ ## 输出要求            │  │ keyPoints:                 │   │
│  │ ### 1) editorNote     │  │ • 要点1                    │   │
│  │ ...                    │  │ • 要点2                    │   │
│  │                        │  │                            │   │
│  │ [测试生成]             │  │ readOriginal:              │   │
│  │                        │  │ score: 2                   │   │
│  └────────────────────────┘  │ reason: ...                │   │
│                               └────────────────────────────┘   │
└────────────────────────────────────────────────────────────────┘
```

**功能列表**：
- 📝 编辑中文/英文 Prompt
- 🎯 选择测试文章
- ⚡ 实时生成并预览结果
- 💾 保存 Prompt 配置

---

### 5. 系统设置 (`/admin/settings`)

配置系统参数。

**可配置项**：
- AI 模型选择
- 生成参数（温度等）
- 其他系统配置

---

### 6. 用户反馈 (`/admin/feedback`)

管理用户提交的反馈。

**功能列表**：
- 📋 查看所有反馈（含提交时间）
- 🏷️ 标记已处理/未处理
- 🗑️ 删除反馈

---

## API 端点

### 认证

| 端点               | 方法 | 说明                     |
| ------------------ | ---- | ------------------------ |
| `/api/auth/login`  | POST | 登录，返回 session token |
| `/api/auth/logout` | POST | 登出                     |
| `/api/auth/verify` | GET  | 验证 session 有效性      |

### 信息源管理

| 端点                      | 方法   | 说明           |
| ------------------------- | ------ | -------------- |
| `/api/admin/sources`      | GET    | 获取所有信息源 |
| `/api/admin/sources`      | POST   | 添加信息源     |
| `/api/admin/sources/[id]` | PUT    | 更新信息源     |
| `/api/admin/sources/[id]` | DELETE | 删除信息源     |

### 内容管理

| 端点                    | 方法 | 说明           |
| ----------------------- | ---- | -------------- |
| `/api/admin/articles`   | GET  | 获取文章列表   |
| `/api/admin/published`  | GET  | 获取已发布内容 |
| `/api/admin/publishing` | POST | 发布/更新状态  |
| `/api/admin/regenerate` | POST | 重新生成摘要   |

### 配置

| 端点                       | 方法 | 说明             |
| -------------------------- | ---- | ---------------- |
| `/api/admin/prompt-config` | GET  | 获取 Prompt 配置 |
| `/api/admin/prompt-config` | POST | 保存 Prompt 配置 |

### 其他

| 端点                        | 方法 | 说明         |
| --------------------------- | ---- | ------------ |
| `/api/admin/fetch-rss`      | POST | 手动抓取 RSS |
| `/api/admin/test-prompt`    | POST | 测试 Prompt  |
| `/api/admin/quality-filter` | POST | 质量过滤     |

---

## 数据存储

Admin 相关数据存储在 `data/` 目录（本地）或 Cloudflare R2（云端）：

| 文件                                  | 说明          |
| ------------------------------------- | ------------- |
| `sources.json`                        | 信息源配置    |
| `settings.json`                       | 系统设置      |
| `feedback.json`                       | 用户反馈      |
| `feeds/{sourceId}/items.json`         | RSS 原始数据  |
| `feeds/{sourceId}/{date}-{lang}.json` | AI 生成的摘要 |

---

## 权限控制

- 所有 `/admin/*` 页面需要登录
- 所有 `/api/admin/*` 接口需要有效 session
- Session 通过 HTTP-only Cookie 管理

**环境变量配置**：
```
ADMIN_USERS=admin:password123,editor:news2026
```
