# Admin 面板重构 PRD

## 背景

### 当前架构

```
抓取 → 按日期存储 → 按天汇总筛选 → 按天生成摘要
         ↓
    data/raw/2026-01-05/
      ├── rss.json (所有源混在一起)
      └── articles/
```

**问题：**
1. 所有信息源的数据混在 `rss.json` 中，无法独立查看每个源的历史
2. 按天汇总的处理流程不够灵活
3. 无法追溯某条新闻来自哪次同步

---

## 目标

### 核心改变

| 维度         | 当前         | 目标             |
| ------------ | ------------ | ---------------- |
| **数据组织** | 按日期       | 按信息源         |
| **历史追溯** | 只能看当日   | 可看每个源的历史 |
| **处理流程** | 固定按天汇总 | 灵活的挑选->总结 |

---

## 方案设计

### 1. 新的数据存储结构

```
data/
├── sources.json                    # 信息源配置（已有）
├── feeds/                          # 新增：按源存储
│   ├── techcrunch/
│   │   ├── items.json              # 该源所有历史条目
│   │   └── metadata.json           # 同步元数据
│   ├── 36kr/
│   │   ├── items.json
│   │   └── metadata.json
│   └── ...
└── raw/                            # 保留：按天的原始快照（可选）
    └── 2026-01-05/
        └── rss.json
```

#### items.json 结构

```json
{
  "sourceId": "techcrunch",
  "items": [
    {
      "id": "unique-hash",
      "title": "Apple announces new product",
      "link": "https://...",
      "content": "...",
      "pubDate": "2026-01-05T08:00:00Z",
      "syncedAt": "2026-01-05T10:00:00Z",
      "wordCount": 1500,
      "status": "new" | "selected" | "summarized" | "archived"
    }
  ],
  "lastSync": "2026-01-05T10:00:00Z",
  "totalItems": 150
}
```

### 2. Admin 面板新功能

#### 2.1 信息源管理页面（增强）

```
┌────────────────────────────────────────────────────┐
│ 📡 信息源管理                                       │
├────────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────┐   │
│ │ TechCrunch                    [EN] [✓启用]   │   │
│ │ 📊 45 条 | 最近同步: 10分钟前 | 🔄 同步      │   │
│ │ ▶ 展开查看历史                               │   │
│ └──────────────────────────────────────────────┘   │
│                       ↓ 点击展开                    │
│ ┌──────────────────────────────────────────────┐   │
│ │ 历史条目 (45条)          [筛选: 全部 ▼]      │   │
│ │ ────────────────────────────────────────────  │   │
│ │ □ Apple announces new product   1,500字       │   │
│ │   2026-01-05 08:00 | 状态: 新                │   │
│ │ ────────────────────────────────────────────  │   │
│ │ ☑ Google launches AI feature   2,300字       │   │
│ │   2026-01-04 15:00 | 状态: 已选中            │   │
│ └──────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────┘
```

**新增功能：**
- 查看每个源的所有历史条目
- 按状态筛选（新/已选中/已总结/已归档）
- 手动选中/取消条目
- 批量操作

#### 2.2 新闻处理页面（新增）

```
┌────────────────────────────────────────────────────┐
│ 📰 新闻处理                                         │
├────────────────────────────────────────────────────┤
│ 步骤 1: 挑选                                        │
│ ┌──────────────────────────────────────────────┐   │
│ │ 待处理条目 (12条)         [来源: 全部 ▼]     │   │
│ │ ☑ Apple announces...      TechCrunch         │   │
│ │ ☑ Google launches...      The Verge          │   │
│ │ □ Meta updates...         36氪               │   │
│ │                                              │   │
│ │ [🤖 AI 自动筛选]  [手动选择后继续]            │   │
│ └──────────────────────────────────────────────┘   │
│                                                    │
│ 步骤 2: 生成摘要                                    │
│ ┌──────────────────────────────────────────────┐   │
│ │ 已选中 5 条                                   │   │
│ │ [生成中文版]  [生成英文版]  [生成双语版]      │   │
│ └──────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────┘
```

**处理流程：**
1. **挑选阶段**：从所有源的新条目中挑选（AI 辅助或手动）
2. **总结阶段**：对选中的条目生成摘要
3. **发布阶段**：保存到 news 目录 / 发送邮件

### 3. 处理流程对比

#### 当前流程（按天固定）
```
每日定时 → 抓取所有源 → 汇总到一个文件 → AI 筛选 → AI 总结 → 保存
```

#### 新流程（按源灵活）
```
任意时刻 → 同步单个/多个源 → 按源存储
                ↓
         手动/定时触发
                ↓
         从各源挑选条目 → AI/手动筛选 → AI 总结 → 保存
```

---

## 讨论点

> [!IMPORTANT]
> **1. 数据去重策略**
> 同一条新闻可能多次同步，如何处理？
> - 选项 A：基于 URL 去重，只保留最新版本
> - 选项 B：保留所有版本，记录更新历史

> [!IMPORTANT]
> **2. 历史数据保留期限**
> - 选项 A：永久保留所有历史
> - 选项 B：保留 N 天（如 30 天），超期自动归档/删除
> - 选项 C：保留 N 条（如每源最多 500 条）

> [!IMPORTANT]
> **3. 处理流程触发方式**
> - 选项 A：保留定时任务，自动完成挑选→总结→发布
> - 选项 B：完全手动，在 Admin 面板操作
> - 选项 C：混合模式（可定时，也可手动干预）

> [!IMPORTANT]
> **4. 与现有数据的兼容**
> 如何处理 `data/raw/` 中已有的按天数据？
> - 选项 A：保留不动，新系统并行运行
> - 选项 B：迁移到新结构，删除旧数据

---

## 实施阶段

### Phase 1: 数据结构重构
- 创建 `data/feeds/` 目录结构
- 修改同步逻辑，按源存储
- 迁移现有数据（可选）

### Phase 2: Admin 面板增强
- 信息源展开查看历史条目
- 条目状态管理

### Phase 3: 新闻处理流程
- 创建「新闻处理」页面
- 实现挑选→总结→发布流程

### Phase 4: 自动化（可选）
- 定时同步
- 定时处理
- 智能推荐

---

## 预估工作量

| 阶段    | 工作量     |
| ------- | ---------- |
| Phase 1 | 2-3 小时   |
| Phase 2 | 2 小时     |
| Phase 3 | 3-4 小时   |
| Phase 4 | 可选，后续 |
