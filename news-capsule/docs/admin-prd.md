# Admin 后台使用指南

> 新闻胶囊管理后台，用于内容管理、发布和运维

---

## 快速入门

**访问地址**：`/admin`

**认证方式**：用户名/密码登录，通过 `ADMIN_USERS` 环境变量配置

```
ADMIN_USERS=admin:password123
```

---

## 工作流程概览

Admin 后台采用类似新闻编辑室的工作流设计：

```
� 编辑部 → 🏭 印刷厂 → 📚 已出版内容
```

### 状态流转

每条新闻在系统中会经历以下状态：

```
🆕 new (新增)
    ↓
⏳ pending (待审)
    ↓
📋 queued (待出版)
    ↓
✅ published (已出版)

📦 archived (存档) ← 可从任意状态归档
```

---

## 模块详解

### 1. 📰 编辑部 (`/admin`)

主工作台，负责内容筛选和审核。

#### 核心功能

**概览统计**
- 显示信息源总数和已启用数量

**全局筛选器**
- **发布时间**：全部 / 过去 24 小时 / 过去 48 小时 / 过去 7 天
- **状态筛选**：多选支持 🆕 新增、⏳ 待审、📋 待出版、✅ 已出版、📦 存档

**自动存档规则**（可折叠面板）
- 最小字数阈值：低于此字数的内容将被自动存档
- 信息合集关键词：标题包含特定关键词的内容将被自动存档
- 视频检测：以视频为主且文字过少的内容将被自动存档
- 点击 **📦 执行存档筛选** 应用规则

**信息源列表**
- 按语言分组（中文源、英文源）
- 支持两种排序：🔥 按活跃度 / ➕ 按添加时间
- 每个源显示各状态的条目数量和最后同步时间

#### 信息源操作

| 按钮 | 功能 |
| ---- | ---- |
| ✓/○ | 启用/禁用信息源 |
| 🔄 | 同步该信息源的最新内容 |
| 🧹 | 重置（清空所有同步的新闻） |
| 🗑 | 删除信息源 |
| ✏️ | 编辑信息源（名称、RSS URL） |
| ▶/▼ | 展开/收起条目列表 |

#### 条目操作

展开信息源后，可以对每条新闻进行操作：

- 点击标题跳转到原文
- 查看字数和发布时间
- **加入出版队列**：将 new 或 pending 状态的条目加入待出版
- **返回待审**：将 queued 或 archived 状态的条目退回待审
- **存档**：将条目归档

#### 同步功能

页面顶部的同步按钮：
- **🔄 同步**：抓取所有已启用源的最新内容
- 可选择时间范围：过去 24 小时 / 48 小时 / 1 周

---

### 2. 🏭 印刷厂 (`/admin/publishing`)

将筛选好的内容批量发布。

#### 核心功能

**待出版列表**
- 显示所有 queued 状态的条目
- 统计中文版和英文版的条目数量

**语言设置**
- 每条新闻可选择发布到：🇨🇳 中文版 / 🇺🇸 英文版 / 📢 两者
- 支持批量设置所有条目的目标语言

**发布操作**
- 点击 **🚀 确认发布** 开始处理
- 显示实时进度条
- 每条状态显示：🔄 发布中 / ✅ 成功 / ⚠️ 部分成功 / ❌ 失败

**条目操作**
- ✕ 移出待出版（将状态设回 pending）

---

### 3. 📚 已出版内容 (`/admin/published`)

管理已发布的新闻摘要。

#### 核心功能

**概览统计**
- 已出版文章数
- 信息源数量
- 出版日期数量

**筛选器**
- **语言**：中文 / English
- **出版日期**：选择查看特定日期的内容

**文章列表**
- 点击展开查看详情：
  - 📝 编辑摘要
  - 🎯 关键要点
  - 🍎 原文价值评分（0-3 分）
  - 📎 原文链接
- 支持单条重新生成摘要
- 支持删除文章

**批量操作**
- **🔄 重新生成全部**：重新生成当前列表所有文章的摘要（需二次确认）

**Newsletter 发送**
- **📧 发送邮件通知**：预览并发送给订阅者
  - 支持创建草稿（在 Buttondown 后台确认）
  - 支持立即发送

---

### 4. ➕ 添加信息源 (`/admin/sources/add`)

添加新的 RSS 订阅源。

#### 操作步骤

1. **输入 RSS 链接**并点击测试
2. 系统自动检测：
   - 源名称
   - 语言（中文/英文）
   - 数据结构分析
   - 过去 7 天的文章统计
3. **填写配置**：
   - 源名称
   - 语言（中文/英文）
   - 分类（科技/新闻/财经/其他）
4. 点击 **� 添加到配置**

---

### 5. 🧪 Prompt 调试器 (`/admin/prompt-debugger`)

测试和优化 AI 生成摘要的 Prompt。

#### 功能

**Prompt 编辑**
- 分别编辑中文版和英文版 Prompt
- 实时预览 Prompt 内容

**测试生成**
- 选择测试文章
- 点击生成预览结果
- 查看生成的：
  - editorNote（编辑摘要）
  - keyPoints（关键要点）
  - readOriginal（原文价值评估）

**保存配置**
- 将调试好的 Prompt 应用到产品

---

### 6. ⚙️ 设置 (`/admin/settings`)

系统配置管理。

#### OpenAI API Key 配置

**查看当前状态**
- 配置状态（已配置/未配置）
- Key 预览（脱敏显示）
- Key 来源（环境变量 / 设置文件）
- 可用模型列表

**更新 API Key**
1. 输入新的 API Key (`sk-...`)
2. 点击 **测试连接**
3. 测试成功后点击 **保存 API Key**

**删除已保存的 Key**
- 仅当 Key 来源为"设置文件"时可删除
- 删除后将回退到使用环境变量

---

### 7. 💬 用户反馈 (`/admin/feedback`)

查看用户提交的反馈。

#### 功能

- 显示所有反馈列表
- 查看提交时间、联系方式、反馈内容
- 统计反馈总数

---

## API 端点参考

### 认证

| 端点 | 方法 | 说明 |
| --- | --- | --- |
| `/api/auth/check` | GET | 检查认证状态 |
| `/api/auth/login` | POST | 登录 |
| `/api/auth/logout` | POST | 登出 |

### 信息源管理

| 端点 | 方法 | 说明 |
| --- | --- | --- |
| `/api/admin/sources` | GET | 获取所有信息源 |
| `/api/admin/sources` | POST | 添加信息源 |
| `/api/admin/sources/[id]` | GET | 获取源的条目列表 |
| `/api/admin/sources/[id]` | PATCH | 更新源/条目状态 |
| `/api/admin/sources/[id]` | DELETE | 删除信息源 |
| `/api/admin/test-rss` | POST | 测试 RSS 链接 |
| `/api/admin/fetch-rss` | POST | 抓取 RSS 内容 |

### 发布管理

| 端点 | 方法 | 说明 |
| --- | --- | --- |
| `/api/admin/publishing` | GET | 获取待出版条目 |
| `/api/admin/publishing` | POST | 执行发布 |
| `/api/admin/published` | GET | 获取已出版内容 |
| `/api/admin/published/[sourceId]` | DELETE | 删除已发布文章 |
| `/api/admin/regenerate` | POST | 重新生成摘要 |

### 配置与工具

| 端点 | 方法 | 说明 |
| --- | --- | --- |
| `/api/admin/prompt-config` | GET | 获取 Prompt 配置 |
| `/api/admin/prompt-config` | POST | 保存 Prompt 配置 |
| `/api/admin/test-prompt` | POST | 测试 Prompt |
| `/api/admin/quality-filter` | GET | 获取过滤规则 |
| `/api/admin/quality-filter` | POST | 执行质量过滤 |
| `/api/admin/quality-filter` | PUT | 更新过滤规则 |
| `/api/admin/api-keys` | GET | 获取 API Key 状态 |
| `/api/admin/api-keys` | POST | 测试/保存 API Key |
| `/api/admin/api-keys` | DELETE | 删除 API Key |
| `/api/admin/send-newsletter` | GET | 预览 Newsletter |
| `/api/admin/send-newsletter` | POST | 发送 Newsletter |

---

## 侧边栏导航

```
💊 新闻胶囊 (Logo，返回首页)
├── 📰 编辑部
├── 🏭 印刷厂
├── 📚 已出版内容
├── ➕ 添加信息源
├── 🧪 Prompt 调试
├── ⚙️ 设置
└── 💬 用户反馈

[用户信息]
[退出登录]
```

---

## 权限控制

- 所有 `/admin/*` 页面需要登录
- 所有 `/api/admin/*` 接口需要有效 session
- Session 通过 HTTP-only Cookie 管理
